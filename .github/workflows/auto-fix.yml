name: auto-fix-on-push

on:
  push:
    branches-ignore: [main]

jobs:
  autofix-hermes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v6
      
      - name: Auto-fix with Hermes 3
        uses: anomalyco/opencode/github@latest
        with:
          openrouter_api_key: ${{ secrets.HERMES_API_KEY }}
          model: "nousresearch/hermes-3-405b-instruct:free"
          task: "Auto-format code, fix linting errors, add missing tests, improve documentation."
        continue-on-error: true
          
      - run: |
          git config user.name 'OpenCode Bot'
          git config user.email 'bot@opencode.ai'
          git add .
          git commit -m "ðŸ”§ Auto-fixes [Hermes]" || echo "No changes"
          git push

  autofix-deepseek:
    runs-on: ubuntu-latest
    needs: autofix-hermes
    if: always()
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v6
      
      - name: Auto-fix with DeepSeek R1
        uses: anomalyco/opencode/github@latest
        with:
          openrouter_api_key: ${{ secrets.DEEPSEEK_API_KEY }}
          model: "deepseek/deepseek-r1-0528:free"
          task: "Auto-format code, fix linting errors, add missing tests, improve documentation."
        continue-on-error: true
          
      - run: |
          git config user.name 'OpenCode Bot'
          git config user.email 'bot@opencode.ai'
          git add .
          git commit -m "ðŸ”§ Auto-fixes [DeepSeek]" || echo "No changes"
          git push      - uses: actions/checkout@v6
      
      - name: Auto-fix with DeepSeek R1
        uses: anomalyco/opencode/github@latest
        with:
          openrouter_api_key: ${{ secrets.OPENROUTER_API_KEY }}
          model: "deepseek/deepseek-r1-0528:free"
          task: "Auto-format code, fix linting errors, add missing tests, improve documentation."
        continue-on-error: true
          
      - run: |
          git config user.name 'OpenCode Bot'
          git config user.email 'bot@opencode.ai'
          git add .
          git commit -m "ðŸ”§ Auto-fixes [DeepSeek]" || echo "No changes"
          git push
